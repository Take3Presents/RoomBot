FROM node:20-alpine

# Install curl for healthcheck
USER root
RUN apk add --no-cache curl

# Default env; can be overridden by docker-compose.yml
ENV REACT_APP_API_ENDPOINT=http://backend:8000

RUN mkdir /.npm
RUN chown node:node /.npm

RUN mkdir /app
RUN chown node:node /app

USER node

WORKDIR /.npm
# Copy only package.json to avoid relying on (or requiring) a host lockfile
COPY package.json ./
# Install only runtime deps; do not use or create a lockfile
RUN npm install --omit=dev --no-audit --no-fund --no-package-lock

WORKDIR /app

ENTRYPOINT ["/bin/sh"]